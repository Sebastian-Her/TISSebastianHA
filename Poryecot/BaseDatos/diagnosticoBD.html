<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diagnóstico y Cotización · Principal</title>
  <link rel="stylesheet" href="../Style/style2.css">
</head>
<body>

  <div class="breadcrumb"><a href="../Subsistemas/Diagnostico.html">Diagnóstico y Cotización</a> · <a href="../index.html">Inicio</a></div>

  <h1>Diseño de la base de datos del subsistema</h1>
  <p class="lead">Diagrama de la tabla en la base de datos</p>
  <img src="../Assets/diagnostico.png" alt="Diagrama de subsistemas" width="500">

  <h3>Objetivo</h3>
  <p>
    Registrar diagnósticos y generar cotizaciones, mediante un sistema que integre síntomas, pruebas y refacciones requeridas, 
    para proporcionar presupuestos claros y medibles al cliente en el punto de atención.
  </p>

  <h3>Campos</h3>
  <ul>
    <li>Id_diagnostico (DG-YYYY-####)</li>
    <li>Id_orden_servicio</li>
    <li>Id_personal</li>
    <li>síntomas_reportados</li>
    <li>pruebas_realizadas</li>
    <li>hallazgos</li>
    <li>diagnóstico_preliminar</li>
    <li>id_item (lista de refacciones, servicios necesarios)</li>
    <li>total_cotizado* (calculado)</li>
    <li>aprobado_por_cliente (bool)</li>
    <li>fecha_aprobación (null si pendiente)</li>
    <li>notas</li>
  </ul>

  <h2>Código SQL para crear tabla Diagnósticos</h2>
  <pre><code>CREATE TABLE Diagnosticos (
    Id_diagnostico VARCHAR(20) PRIMARY KEY, -- Formato: DG-YYYY-####
    Id_orden_servicio INT NOT NULL,         -- Identificador de la orden de servicio
    Id_personal INT NOT NULL,               -- Identificador del personal que realiza el diagnóstico

    sintomas_reportados TEXT NOT NULL,
    pruebas_realizadas TEXT,
    hallazgos TEXT,
    diagnostico_preliminar TEXT,

    id_item TEXT,                           -- Lista de refacciones o servicios requeridos (puede ser JSON o texto delimitado)

    total_cotizado AS (
        0
    ) PERSISTED,                             -- Campo calculado, inicializado en 0 por simplicidad

    aprobado_por_cliente BIT DEFAULT 0,      -- 0 = pendiente, 1 = aprobado
    fecha_aprobacion DATETIME NULL,
    notas TEXT NULL
);

-- Ejemplo de inserción de datos
INSERT INTO Diagnosticos (
    Id_diagnostico, Id_orden_servicio, Id_personal, sintomas_reportados, pruebas_realizadas,
    hallazgos, diagnostico_preliminar, id_item, aprobado_por_cliente, notas
)
VALUES (
    'DG-2025-0001', 101, 5, 'No enciende', 'Verificación de fuente y batería', 
    'Fuente dañada', 'Se requiere cambio de fuente', '["Fuente 65W", "Mano de obra"]', 0, 'Cliente contactado'
);</code></pre>

</body>
</html>
